# Dynamic Configuration
# https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04

http:
  routers:
    api:
      rule: Host(`eoastest.xyz`) && (PathPrefix(`/api`) || PathPrefix(`/dashboard`))
      service: api@internal
      entrypoints:
        - websecure
      middlewares:
        - simpleAuth
        - dashboard-strip-slash
      tls:
        certResolver: lets-encrypt
  middlewares:
    simpleAuth:
      basicAuth:
        users:
          - "eoas:$2y$05$2N25nFVO13/Xxv4JUetyou5eo2xnrZ5rUHXJF0/P59gwZUGgZUdrC"
# https://community.traefik.io/t/middleware-to-add-the-if-needed/1895/19
    dashboard-strip-slash:
        redirectRegex:
          regex: (^.*\/dashboard$)
          replacement: "${1}/"
          permanent: false